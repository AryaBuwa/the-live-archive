name: Alive Archive - Keep Apps Alive

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  wake:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Playwright
        run: |
          pip install playwright
          playwright install chromium

      - name: Wake Apps
        run: |
          python - <<EOF
          from playwright.sync_api import sync_playwright

          urls = [
              "https://cafemenu.streamlit.app",
              "https://vibescan.streamlit.app"
          ]

          with sync_playwright() as p:
              browser = p.chromium.launch(headless=True)

              for url in urls:
                  print(f"\nOpening {url}")
                  page = browser.new_page()
                  page.goto(url, timeout=60000)

                  try:
                      page.get_by_role("button", name="Yes, get this app back up!").click(timeout=25000)
                      print("Clicked wake button.")
                  except:
                      print("Wake button not found (app may already be awake).")

                  page.wait_for_timeout(25000)
                  print("Waited 25 seconds for full load.")

                  page.close()

              browser.close()

          print("All apps processed.")
          EOF
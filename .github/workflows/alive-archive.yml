name: Wake My App

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  wake:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Playwright
        run: |
          pip install playwright
          playwright install chromium

      - name: Run Robot
        run: |
          python - <<EOF
          from playwright.sync_api import sync_playwright

          urls = [
              "https://cafemenu.streamlit.app",
              "https://vibescan.streamlit.app"
          ]

          with sync_playwright() as p:
              browser = p.chromium.launch()
              for url in urls:
                  print(f"Opening {url}")
                  page = browser.new_page()
                  page.goto(url)
                  page.wait_for_timeout(15000)

                  try:
                      if page.get_by_text("Yes, get this app back up").is_visible(timeout=5000):
                          page.get_by_text("Yes, get this app back up").click()
                          print(f"Clicked wake button for {url}")
                  except:
                      print(f"No wake button found for {url}")

                  page.close()

              browser.close()
          EOF